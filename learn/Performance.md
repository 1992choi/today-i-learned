# Spring
- Fast Campus > 궁극의 성능 튜닝과 트러블슈팅

<br><br><br>

# 정리
### 성능
- 성능이 중요한 이유
  - 사용자 유지를 좌우한다.
  - 느린 사이트는 수익에 부정적인 영향을 미치고 빠른 사이트는 전환율을 높인다.
- 성능 측정 지표
  - LCP (Largest Contentful Paint)
    - 로딩 성능을 측정한다.
    - 우수한 사용자 경험을 제공하려면 페이지가 처음으로 로딩된 후 2.5초 이내에 LCP가 발생해야 한다.
  - FID (First Input Delay)
    - 최초 입력 지연
    - 우수한 사용자 경험을 제공하려면 페이지의 FID가 100밀리초 이하여야 한다.
  - CLS (Cumulative Layout Shift)
    - 시각적 안정성을 측정한다.
    - 우수한 사용자 경험을 제공하려면 페이지에서 0.1 이하의 CLS를 유지해야 한다.
- 성능의 주요 지표
  - 사용자 (Users)
    - 서비스를 사용하는 사용자의 수
    - 성능 테스트 관점에서 사용자는 Active User 와 Concurrent User 로 나눌 수 있다.
      - Active User
        - 서비스에 요청을 하고 기다리는 사용자다.
        - 메뉴나 링크를 누르고 결과가 나오기를 기다리는 사용자다.
      - Concurrent User
        - Active User 를 포함한다.
        - 웹 페이지를 띄워 놓은 사용자나 앱을 실행하고 있는 사용자 (아직 직접적인 요청은 없지만 요청을 행할 수 있는 존재)다.
  - 응답시간 (Response Time)
    - 각 요청에 대한 응답시간
    - Application server 에서 소요되는 시간은 CPU time과 Wait time으로 나눌 수 있다.
      - CPU time
        - CPU 연산을 하면서 소요되는 시간이다.
      - Wait time
        - DB의 결과를 기다리거나, API 호출한 후 대기하는 등 기다리는 시간을 의미한다.
  - 초당 처리량 (Transactions Per Seconds,TPS)
    - 1초에 처리 가능한 트랜젝션의 수다.
  - 리소스 사용량 (Resource Usage)
    - CPU, 메모리, 네트워크 등 부하 발생시 리소스 사용량이다.

### 병목
- 병목이 발생할 수 있는 지점
  - Database
    - Full scan 문제
      - 가장 흔히 발생하는 유형으로 index가 잡혀 있지 않으면, 테이블 full scan이 일어날 수 있다.
    - N+1 문제
      - JPA를 사용할 경우 N+1 문제가 발생하여, 병목현상이 발생하는 케이스다.
  - Server
    - OS 버전이 낮아 각종 버그를 포함한 상태에서 서비스를 지속할 경우다.
    - OS 내의 각종 설정값들이 기본으로 되어 있어서 서비스의 특성에 맞는 튜닝이 되어 있지 않은 경우다.
    - 리소스가 부족한 경우
      - 먼저 튜닝을 해야하고, 튜닝이 완료 되었는데도 해결이 안되면 서버를 증설 고려한다.
        - 수직(Vertical) 확장
          - CPU clock 이 더 좋은 장비로 변경, 메모리 증설 등 서버 스펙을 올리는 확장이다.
        - 수평(Horizontal) 확장
          - 서버 대수를 증가 시키는 방식의 스펙 확장이다.
  - Network
    - 네트워크 작업이 주가 되는 서비스에서는 네트워크 설정과 장비 구성이 중요한 역할을 하기 때문에, 자바 기반의 네트워크 구성을 관리하는 네트워크 토폴로지(Network Topology)는 항상 확인 가능해야 한다.
  - 연계서버
    - 연계되는 내 외부 서비스에서 성능이 나오지 않으면 우리 서비스의 장애로 이어질 수밖에 없다.
    - 연계서버의 성능 이슈나 장애 발생 시, 전파되지 않도록 연결관련 설정은 필수적으로 하는 것이 좋다.
